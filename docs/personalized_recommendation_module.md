# 个性化推荐模块

## 概述

个性化推荐模块是搜索引擎的扩展功能，通过分析用户的搜索行为和兴趣偏好，向用户提供相关内容推荐，提升用户体验。本模块实现了两种推荐方式之一：搜索联想关联，为用户提供更精准的查询建议。

## 技术选择

1. **关联分析**: 使用 Apriori 算法分析查询关联关系
2. **文本相似度**: 使用 TF-IDF 和余弦相似度计算内容相似性
3. **查询日志分析**: 基于历史查询数据挖掘用户意图
4. **数据存储**: Redis 缓存推荐结果，SQLite 存储用户行为数据

## 搜索联想关联

### 功能描述

在用户输入查询关键词时，实时提供相关的查询建议：

1. **输入补全**: 根据用户已输入内容预测可能的完整查询
2. **相关查询**: 推荐与当前查询语义相关的其他查询
3. **热门查询**: 推荐当前热门或时下流行的查询
4. **个性化建议**: 基于用户历史行为的定制化建议

### 实现方法

#### 查询关联分析

通过分析查询日志构建查询关联网络：

1. **共现分析**: 统计查询词的共现频率
2. **序列模式挖掘**: 分析用户查询序列的模式
3. **关联规则挖掘**: 使用 Apriori 算法挖掘查询关联规则

#### 查询日志模型

```json
{
    "query_graph": {
        "南开大学": {
            "南开大学专业": 0.23,
            "南开大学图书馆": 0.18,
            "南开大学排名": 0.15
        },
        "选课系统": {
            "南开选课": 0.35,
            "选课指南": 0.22,
            "课表查询": 0.17
        }
    },
    "popular_queries": [
        { "query": "2025秋季选课", "count": 1245 },
        { "query": "南开大学考试安排", "count": 982 },
        { "query": "图书馆开放时间", "count": 754 }
    ]
}
```

#### 实时推荐算法

1. **前缀匹配**: 对输入的前缀进行匹配
2. **编辑距离**: 容忍拼写错误和变体
3. **相关性排序**: 结合关联度和流行度进行排序
4. **个性化因子**: 根据用户历史调整推荐排序

### API 设计

```
GET /api/suggest
    - 查询建议接口
    - 参数：q(已输入的查询词), user_id(可选), limit

GET /api/related
    - 相关查询接口
    - 参数：q(完整查询词), user_id(可选), limit
```

## 个性化展示

### 结果聚类与多样性

确保推荐结果的多样性：

1. **结果聚类**: 将相似的推荐归为一组
2. **多样性保障**: 从不同类别中选择推荐项
3. **兴趣平衡**: 在用户已知兴趣和潜在兴趣间取得平衡

### 时效性处理

考虑推荐内容的时效性：

1. **时间衰减**: 较旧的内容权重降低
2. **热点提升**: 近期热门内容权重提升
3. **季节性调整**: 考虑特定时间点的相关内容(如选课期、考试周)

## 推荐系统评估

评估推荐效果的指标：

1. **接受率**: 用户接受推荐的比例
2. **点击率**: 推荐内容被点击的概率
3. **相关度**: 推荐内容与用户兴趣的匹配度
4. **多样性**: 推荐内容的多样化程度
5. **新颖性**: 推荐中包含用户未知内容的程度

## 实现计划

1. 构建查询日志分析系统
2. 开发查询关联模型
3. 实现实时推荐算法
4. 设计前端交互界面
5. 开发 API 接口
6. 系统集成与测试

## 前端展示

### 搜索框自动完成

在搜索框中实时展示推荐：

1. **下拉菜单**: 显示推荐查询列表
2. **高亮匹配**: 高亮匹配的关键词部分
3. **分类展示**: 按不同类别(热门、相关、历史)分组展示
4. **快捷操作**: 支持键盘导航和快速选择

### 搜索结果页面推荐

在搜索结果页面展示相关查询：

1. **顶部推荐**: 在结果顶部展示相关查询
2. **侧边推荐**: 在页面侧边栏展示相关内容
3. **底部推荐**: 在结果底部展示扩展查询
4. **交互式反馈**: 允许用户对推荐进行反馈
